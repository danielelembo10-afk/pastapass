<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>PastaPass â€” Scan</title>
  <link rel="icon" href="/web/assets/logo.png">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800;900&display=swap" rel="stylesheet">
  <style>
    :root{ --gold:#f1c40f }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,Arial; color:#eee;
      background:#0c0c0c;
      background:
        linear-gradient(90deg,#1b8f3a 0 33.33%, #ffffff 33.33% 66.66%, #d32f2f 66.66% 100%) fixed,
        linear-gradient(#00000088,#00000088);
      background-blend-mode: overlay;
    }
    header{ padding:18px 20px; display:flex; justify-content:center; }
    .logo{ width:min(90%,520px); max-width:520px; height:auto; display:block; filter: drop-shadow(0 8px 24px rgba(0,0,0,.25)); }
    .page{ padding:24px; max-width:520px; margin:auto }
    input{ width:100%; padding:12px; border-radius:10px; border:1px solid #444; background:#181818; color:#fff }
    button{ margin-top:10px; padding:12px 16px; border:0; border-radius:12px; background:#fff; color:#000; font-weight:900; cursor:pointer }
    .plates{ display:flex; flex-wrap:wrap; gap:8px; margin-top:10px }
    .plate{ width:34px; height:34px; border-radius:50%; background:#000; border:1px solid #555; display:grid; place-items:center; box-shadow: inset 0 0 0 2px #2a2a2a }
    .plate svg{ width:22px; height:22px }
    .plate .pasta{ fill:#7a7a7a }
    .plate.earned .pasta{ fill:var(--gold) }
    .reward{ margin-top:10px; padding:10px 12px; border-radius:10px; background:#143513; color:#d6ffd0; border:1px solid #2e6f2b; display:none }
  </style>
</head>
<body>
  <header>
    <img class="logo" src="/web/assets/logo.png" alt="logo">
  </header>

  <div class="page">
    <h3>Stamp your PastaPass</h3>
    <p style="opacity:.8">Enter your email or phone used at signup:</p>
    <input id="identifier" placeholder="email or phone">
    <button onclick="go()">Stamp</button>

    <div id="out" style="margin-top:8px"></div>
    <div id="plates" class="plates"></div>
    <div id="reward" class="reward"></div>
  </div>

  <script>
    const pastaSVG = `
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path class="pasta" d="M4 12c0-3.3 3.1-6 6.9-6 2.1 0 4 .8 5.2 2 .3.3.3.8 0 1.1-.3.3-.8.3-1.1 0-1-1-2.5-1.6-4.1-1.6-3 0-5.4 1.9-5.4 4.3s2.4 4.3 5.4 4.3c1.6 0 3.1-.6 4.1-1.6.3-.3.8-.3 1.1 0 .3.3.3.8 0 1.1-1.2 1.2-3.1 2-5.2 2C7.1 18 4 15.3 4 12zM14 8c.4 0 .8.3.8.8S14.4 9.5 14 9.5s-.8-.3-.8-.8.3-.7.8-.7zm2.8 3.2c.4 0 .8.3.8.8s-.3.8-.8.8-.8-.3-.8-.8.4-.8.8-.8z"/>
      </svg>`;

    function renderPlates(stamps){
      const total=10, el=document.getElementById('plates'); el.innerHTML='';
      for(let i=0;i<total;i++){
        const d=document.createElement('div');
        d.className='plate'+(i<stamps?' earned':''); d.innerHTML=pastaSVG; el.appendChild(d);
      }
    }

    async function go(){
      const idf = document.getElementById('identifier').value.trim();
      const token = decodeURIComponent(location.hash.slice(1));
      const r = await fetch('/api/stamps/add', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ identifier:idf, token })});
      const j = await r.json();
      if(!r.ok){ document.getElementById('out').textContent = 'Error: ' + (j.error||'unknown'); return; }
      document.getElementById('out').textContent = 'Stamp added!';
      renderPlates(j.stamps||0);
      const rw=document.getElementById('reward');
      if(j.rewardCode){ rw.style.display='block'; rw.textContent="ðŸŽ‰ Reward unlocked! Code: "+j.rewardCode; }
      else { rw.style.display='none'; rw.textContent=''; }
    }

    renderPlates(0);
  </script>
</body>
</html>
